# –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Remote MCP —Å–µ—Ä–≤–µ—Ä–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ remote MCP —Å–µ—Ä–≤–µ—Ä–∞ Kiwi.com –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
400 Bad Request: mcp_servers: Extra inputs are not permitted
```

## –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

–í—ã –ø—ã—Ç–∞–ª–∏—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –º–∞—Å—Å–∏–≤ `tools` –æ–±—ä–µ–∫—Ç `mcp_toolset` —Å –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:
```kotlin
add(JsonObject(mapOf(
    "type" to JsonPrimitive("mcp_toolset"),
    "mcp_server_name" to JsonPrimitive("kiwi-com-flight-search"),
    "default_config" to JsonObject(...),  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
    "configs" to JsonObject(...)          // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
)))
```

–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Claude API, `mcp_toolset` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```kotlin
add(JsonObject(mapOf(
    "type" to JsonPrimitive("mcp_toolset"),
    "mcp_server_name" to JsonPrimitive("kiwi-com-flight-search")  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
)))
```

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ClaudeClient.kt
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `getFilteredTools()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `mcp_toolset`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω beta header `anthropic-beta: mcp-client-2025-11-20` –¥–ª—è MCP connector
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä `remoteMcp` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `getFilteredTools()`

### 2. RemoteMCPClient.kt
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö remote MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ Kiwi.com —Å–µ—Ä–≤–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω

### 3. MCPTools.kt
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è remote —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ remote —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ `getToolsDefinitions()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–∞ —Ç–∏–ø–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### 4. HealthRoutes.kt
- ‚úÖ Endpoint `/api/tools` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏ remote –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `type` –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è

### 5. ApiModels.kt
- ‚úÖ `ToolInfo` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `type` ("local" –∏–ª–∏ "remote_mcp")

### 6. ui/index.html
- ‚úÖ UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç remote MCP —Å–µ—Ä–≤–µ—Ä—ã –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–µ–π
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ: –≥–æ–ª—É–±–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç + –∏–∫–æ–Ω–∫–∞ üåê
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ "–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" –∏ "Remote MCP —Å–µ—Ä–≤–µ—Ä—ã"

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
./gradlew run
```

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ UI
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:8080

### –®–∞–≥ 3: –í–∫–ª—é—á–∏—Ç–µ Kiwi.com MCP —Å–µ—Ä–≤–µ—Ä
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ (‚öôÔ∏è) –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
2. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ —Ä–∞–∑–¥–µ–ª–∞ "üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã MCP"
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é "üåê Remote MCP —Å–µ—Ä–≤–µ—Ä—ã"
4. –í–∫–ª—é—á–∏—Ç–µ —á–µ–∫–±–æ–∫—Å "üåê kiwi-com-flight-search"

### –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —á–∞—Ç–µ
–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –æ –ø–æ–∏—Å–∫–µ –∞–≤–∏–∞–±–∏–ª–µ—Ç–æ–≤:
```
–ù–∞–π–¥–∏ –º–Ω–µ —Ä–µ–π—Å—ã –∏–∑ –ú–æ—Å–∫–≤—ã –≤ –ü–∞—Ä–∏–∂ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–µ
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ API –∑–∞–ø—Ä–æ—Å–∞ –∫ Claude

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```json
{
  "tools": [
    {
      "type": "mcp_toolset",
      "mcp_server_name": "kiwi-com-flight-search",
      "default_config": { ... },
      "configs": { ... }
    }
  ],
  "mcp_servers": [ ... ]
}
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ)
```json
{
  "mcp_servers": [
    {
      "type": "url",
      "url": "https://mcp.kiwi.com",
      "name": "kiwi-com-flight-search"
    }
  ],
  "tools": [
    {
      "type": "mcp_toolset",
      "mcp_server_name": "kiwi-com-flight-search"
    }
  ]
}
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö remote MCP —Å–µ—Ä–≤–µ—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `app/src/main/kotlin/com/claude/agent/services/RemoteMCPClient.kt`:

```kotlin
private val availableServers = mapOf(
    "kiwi-com-flight-search" to RemoteMCPServerConfig(
        name = "kiwi-com-flight-search",
        url = "https://mcp.kiwi.com",
        description = "–ü–æ–∏—Å–∫ –∞–≤–∏–∞–±–∏–ª–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Kiwi.com",
        enabled = false
    ),
    // –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä –∑–¥–µ—Å—å:
    "my-custom-server" to RemoteMCPServerConfig(
        name = "my-custom-server",
        url = "https://my-mcp-server.com",
        description = "–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞",
        enabled = false
    )
)
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –ø–æ—è–≤–∏—Ç—Å—è –≤ UI.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º Kiwi.com —Å–µ—Ä–≤–µ—Ä–æ–º, –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
INFO - –ê–∫—Ç–∏–≤–Ω—ã–µ remote MCP —Å–µ—Ä–≤–µ—Ä—ã: 1 —à—Ç.
INFO - MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: X —à—Ç.
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫
–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞:
```
ERROR - –û—à–∏–±–∫–∞ API: 400, body: {"type":"error","error":{"type":"invalid_request_error","message":"mcp_servers: Extra inputs are not permitted"}}
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UI
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å –æ–±—ã—á–Ω—ã–º —Ñ–æ–Ω–æ–º
- Remote MCP —Å–µ—Ä–≤–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≥–æ–ª—É–±–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏ –∏–∫–æ–Ω–∫—É üåê

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Beta header
–î–ª—è —Ä–∞–±–æ—Ç—ã MCP connector —Ç—Ä–µ–±—É–µ—Ç—Å—è header:
```
anthropic-beta: mcp-client-2025-11-20
```

–≠—Ç–æ—Ç header –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ remote MCP —Å–µ—Ä–≤–µ—Ä—ã.

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ
- **Remote MCP —Å–µ—Ä–≤–µ—Ä—ã** –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Claude API –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. Remote MCP —Å–µ—Ä–≤–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ HTTP/SSE
2. –õ–æ–∫–∞–ª—å–Ω—ã–µ STDIO —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ tool calls (–Ω–µ resources, –Ω–µ prompts)
4. MCP connector –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Amazon Bedrock –∏ Google Vertex

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Claude MCP Connector: https://platform.claude.com/docs/en/agents-and-tools/mcp-connector
- Kiwi.com MCP Server: https://mcp.kiwi.com

